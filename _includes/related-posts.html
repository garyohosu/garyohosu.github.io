{% comment %}
Auto-related posts by tag/category overlap. Shows up to 3 items.
{% endcomment %}
{% assign shown = 0 %}
{% assign max_related = page.related_limit | default: 3 %}
{% if page.tags or page.categories %}
<div class="note" style="margin-top:2rem; padding:1rem 1.2rem; border-radius:12px; background:rgba(148,163,184,.12);">
  <strong style="display:block; margin-bottom:.6rem;">関連記事</strong>
  <ul style="margin:0; padding-left:1.1rem;">
  {% for p in site.posts %}
    {% if p.url != page.url and shown < max_related %}
      {% assign match = false %}
      {% if page.tags and p.tags %}
        {% for t in p.tags %}
          {% if page.tags contains t %}{% assign match = true %}{% endif %}
        {% endfor %}
      {% endif %}
      {% if match == false and page.categories and p.categories %}
        {% for c in p.categories %}
          {% if page.categories contains c %}{% assign match = true %}{% endif %}
        {% endfor %}
      {% endif %}
      {% if match %}
        <li style="margin:.25rem 0;">
          <a href="{{ p.url | relative_url }}">{{ p.title }}</a>
          <span style="opacity:.75; font-size:.9em;">（{{ p.date | date: '%Y/%m/%d' }}）</span>
        </li>
        {% assign shown = shown | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}
  {% if shown == 0 %}
    <li style="margin:.25rem 0; opacity:.8;">関連する投稿はまだありません。</li>
  {% endif %}
  </ul>
</div>
{% endif %}

